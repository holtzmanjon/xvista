#include "Vista.h"
      SUBROUTINE TEXT(A,IMAGESR,IMAGEER,IMAGESC,IMAGEEC)

      REAL A(IMAGESC:IMAGEEC,IMAGESR:IMAGEER)

      INTEGER FILL, ROT, ROW, COL, SCALE
      CHARACTER STRING*80, TWORD*80, PARM*8
      LOGICAL HAVETEXT, KEYCHECK

#ifdef VMS
      INCLUDE 'VINCLUDE:VISTALINK.INC'
      INCLUDE 'VINCLUDE:IMAGELINK.INC'
#else
      INCLUDE 'vistadisk/source/include/vistalink.inc'
      INCLUDE 'vistadisk/source/include/imagelink.inc'
#endif

      CALL KEYINIT
      CALL KEYDEF('FILL=')
      CALL KEYDEF('ROT=')
      CALL KEYDEF('TEXT=')
      CALL KEYDEF('SCALE=')
      CALL KEYDEF('X0=')
      CALL KEYDEF('Y0=')

      X0 = 0
      Y0 = 0
      ROT = 0
      SCALE = 1
      FILL = 0
      HAVETEXT = .FALSE.

      DO 5701 I=1,NCON
	 TWORD = WORD(I)
	 L = UPPER(TWORD)
	 IF (TWORD(1:5) .EQ. 'FILL=') THEN
	   CALL ASSIGN(WORD(I),TMP,PARM)
	   IF (XERR) RETURN
	   FILL = NINT(TMP)
	 ELSE IF (TWORD(1:4) .EQ. 'ROT=') THEN
	   CALL ASSIGN(WORD(I),TMP,PARM)
	   IF (XERR) RETURN
	   ROT = NINT(TMP)
	 ELSE IF (TWORD(1:5) .EQ. 'TEXT=') THEN
	   STRING = WORD(I)(6:)
	   HAVETEXT = .TRUE.
	 ELSE IF (TWORD(1:6) .EQ. 'SCALE=') THEN
	   CALL ASSIGN(WORD(I),TMP,PARM)
	   IF (XERR) RETURN
	   SCALE = NINT(TMP)
	 ELSE IF (TWORD(1:3) .EQ. 'X0=') THEN
	   CALL ASSIGN(TWORD,TMP,PARM)
	   IF (XERR) RETURN
	   COL = NINT(TMP)
	 ELSE IF (TWORD(1:3) .EQ. 'Y0=') THEN
	   CALL ASSIGN(TWORD,TMP,PARM)
	   IF (XERR) RETURN
	   ROW = NINT(TMP)
	 ELSE IF (TWORD(1:4) .EQ. 'ROW=') THEN
	   CALL ASSIGN(TWORD,TMP,PARM)
	   IF (XERR) RETURN
	   ROW = NINT(TMP)
	 ELSE IF (TWORD(1:4) .EQ. 'COL=') THEN
	   CALL ASSIGN(TWORD,TMP,PARM)
	   IF (XERR) RETURN
	   COL = NINT(TMP)
	 END IF
5701   CONTINUE

       IF (.NOT. KEYCHECK()) THEN
	  XERR = .TRUE.
	  RETURN
       END IF

       IF (.NOT. HAVETEXT) THEN
	  PRINT '(1x,''Enter text to draw: ''$)'
	  READ '(A)', STRING
       END IF
	   
       L = NUMCHAR(STRING)
       STRING(L+1:L+1) = CHAR(0)

#ifdef VMS
       CALL CTEXT(A,IMAGEEC-IMAGESC+1,IMAGEER-IMAGESR+1,%ref(STRING),
#else
       CALL CTEXT(A,IMAGEEC-IMAGESC+1,IMAGEER-IMAGESR+1,STRING,
#endif
     &     COL-IMAGESC,ROW-IMAGESR,FILL,ROT,SCALE)	

       RETURN
       END
