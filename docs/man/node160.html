
<H1><A NAME="SECTION001480000000000000000">
ALIGN: Linearize or Transform a Wavelength-Calibrated Spectrum</A>
</H1>
<tex2html_verbatim_mark>rawhtml393#
<A NAME="5834"><tex2html_anchor_invisible_mark></A>
<A NAME="5835"><tex2html_anchor_invisible_mark></A>
<A NAME="5836"><tex2html_anchor_invisible_mark></A>
<BR>
<tex2html_image_mark>#command5837#
<BR>

<P>
ALIGN will transform the rows of an image from the original pixel scale to
either a linear scale or a logarithmic scale. The physical pixel units
defined on the FITS card CTYPE1 are arbitrary (Wavelength, Time, RA, etc)
We will refer mostly to wavelengths in angstroms but other units are
treated analogously. Columns can be aligned after a right angle rotation of
the image.

<P>
Spectral pixels are re-binned onto the new wavelength scale using a
Lagrangian interpolation algorithm.  Lagrangian interpolation conserves
area (under binned data as opposed to sampled data), runs faster, and
produces less ;SPMquot;ringing;SPMquot; when interpolating undersampled data than
resampling algorithms (like SINC interpolation).

<P>
If the pixel-scale is not one of wavelength (or ln<#5872#>Wavelength<#5872#>) the scale
used is the linear scale defined by the FITS cards CRVAL1, CDELT1, and
CRPIX1, so the original image can be on any of the 3 scales supported by
VISTA:
<PRE><tex2html_verbatim_mark>verbatim394#</PRE> 

<P>
To ALIGN 1-D or long-slit (2-D) spectra, first compute a polynomial
wavelength calibration from an appropriate lamp spectrum using the LINEID
and WSCALE command.  Then copy the results to the object image using the
COPW command.  ALIGN can then be used to transform the image onto the
desired final (linear or logarithmic) wavelength scale. If you want to
edit the FITS cards directly, note that the REVERSE fit (pixel as a
function of wavelength) computed by WSCALE is the fit actually used within
ALIGN.

<P>
If the image is initially on a VISTA polynomial wavelength scale
(CTYPE1=LAMBDA_POLY), the observed intensities are converted to an
uncalibrated F-Lambda scale (counts/sec/Angstrom), unless the NOFLUX word
is given. This conversion is done by dividing each pixel by (1) the
integration time (FITS header EXPOSE or EXPTIME card) and (2) the width of
each pixel in Angstroms (note that for a polynomial wavelength scale in raw
spectra, the number of Angstroms spanned by each pixel changes as a
function of position).  If you are aligning co-added (;SPMquot;stacked;SPMquot;) images,
the integration-time data in the FITS header must be changed to the
appropriate <I>total</I> integration time.

<P>
To specify the dispersion and zero-point of the new pixel scale, you may
supply ALIGN with the desired dispersion and reference pixel using DSP=disp
keyword to specify the desired new dispersion, and W=l,p where 'l' to give
the lambda at the reference pixel 'p' in the final aligned image. The
default of these references are those of the image's first column. If the
original pixel scale is other than raw-pixels, ALIGN will set the starting
column of the final image to be pixel 1.

<P>
The keywords DP=dp, DS=ds, and LCMOD=n can remove the effects of having a
different scale on the FITS cards and on the image rows due to geometric
distortions (like flexure shifts, Optical distortions, Line-Curvature,
etc). A combination of DP=dp and DS=ds will take care of simple cases where
distortions can be characterized by a single shift plus a linear a stretch
of the form:
<PRE><tex2html_verbatim_mark>verbatim395#</PRE> 

<P>
LCMOD=b can remove more general distortions than the linear case allowed by
keywords DP=dp and DS=ds, since a different polynomial distortion may be
removed from each row of the image. Buffer b should hold the polynomial
coefficients (in the format generated by command ROWFIT LOAD=b) giving, for
each row the distortion relation :
<PRE><tex2html_verbatim_mark>verbatim396#</PRE> 
To remove or to add effects due to redshift, the user may use keywords V=v,
Z=z, RED=z, and/or DERED=z. V=v, will REMOVE a velocity shift of v km/sec
(one way to conveniently remove known radial velocities from an image). Z=z
or DERED=z will REMOVE a redshift of 'z' from the image rows. RED=z will
redshift the spectrum by 'z'. Note that RED=z is NOT the same as DERED=-z
or Z=z (since 1-z, used by Z=z and DERED=-z, is not equal to 1/(1+z), used
by RED=z).

<P>
Any combination of keywords is allowed to remove or to add distortions,
shifts or redshifts. Note that DSP=disp and W=l,p refer to the dispersion
and zero-point of the new final scale (i.e. AFTER removing the net combined
effect)

<P>
Other keywords provide a variety of options as follows:
<BR>
<tex2html_image_mark>#example5880#
<BR> 

<P>
<#5888#>Examples:<#5888#>
<BR>
<tex2html_image_mark>#example5889#
<BR>

<P>
